C51 COMPILER V9.51   USBFS_CLS                                                             02/02/2016 10:48:32 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE USBFS_CLS
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\USBFS_cls.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\Generated_Source\PSoC3\USBFS_cls.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB DF(DEBU
                    -G) WL(2) PR(.\DP8051\DP8051_Keil_951\Debug/USBFS_cls.lst) CD OT(5,SIZE) OJ(.\DP8051\DP8051_Keil_951\Debug\USBFS_cls.obj)

line level    source

   1          /*******************************************************************************
   2          * File Name: USBFS_cls.c
   3          * Version 2.80
   4          *
   5          * Description:
   6          *  USB Class request handler.
   7          *
   8          * Note:
   9          *
  10          ********************************************************************************
  11          * Copyright 2008-2014, Cypress Semiconductor Corporation.  All rights reserved.
  12          * You may use this file only in accordance with the license, terms, conditions,
  13          * disclaimers, and limitations in the end user license agreement accompanying
  14          * the software package with which this file was provided.
  15          *******************************************************************************/
  16          
  17          #include "USBFS.h"
  18          
  19          #if(USBFS_EXTERN_CLS == USBFS_FALSE)
  20          
  21          #include "USBFS_pvt.h"
  22          
  23          
  24          
  25          /***************************************
  26          * User Implemented Class Driver Declarations.
  27          ***************************************/
  28          /* `#START USER_DEFINED_CLASS_DECLARATIONS` Place your declaration here */
  29          
  30          /* `#END` */
  31          
  32          
  33          /*******************************************************************************
  34          * Function Name: USBFS_DispatchClassRqst
  35          ********************************************************************************
  36          * Summary:
  37          *  This routine dispatches class specific requests depend on interface class.
  38          *
  39          * Parameters:
  40          *  None.
  41          *
  42          * Return:
  43          *  requestHandled.
  44          *
  45          * Reentrant:
  46          *  No.
  47          *
  48          *******************************************************************************/
  49          uint8 USBFS_DispatchClassRqst(void) 
  50          {
  51   1          uint8 requestHandled = USBFS_FALSE;
  52   1          uint8 interfaceNumber = 0u;
  53   1      
C51 COMPILER V9.51   USBFS_CLS                                                             02/02/2016 10:48:32 PAGE 2   

  54   1          switch(CY_GET_REG8(USBFS_bmRequestType) & USBFS_RQST_RCPT_MASK)
  55   1          {
  56   2              case USBFS_RQST_RCPT_IFC:        /* Class-specific request directed to an interface */
  57   2                  interfaceNumber = CY_GET_REG8(USBFS_wIndexLo); /* wIndexLo contain Interface number */
  58   2                  break;
  59   2              case USBFS_RQST_RCPT_EP:         /* Class-specific request directed to the endpoint */
  60   2                  /* Find related interface to the endpoint, wIndexLo contain EP number */
  61   2                  interfaceNumber = USBFS_EP[CY_GET_REG8(USBFS_wIndexLo) &
  62   2                                    USBFS_DIR_UNUSED].interface;
  63   2                  break;
  64   2              default:    /* RequestHandled is initialized as FALSE by default */
  65   2                  break;
  66   2          }
  67   1          /* Handle Class request depend on interface type */
  68   1          switch(USBFS_interfaceClass[interfaceNumber])
  69   1          {
  70   2              case USBFS_CLASS_HID:
  71   2                  #if defined(USBFS_ENABLE_HID_CLASS)
  72   2                      requestHandled = USBFS_DispatchHIDClassRqst();
  73   2                  #endif /* USBFS_ENABLE_HID_CLASS */
  74   2                  break;
  75   2              case USBFS_CLASS_AUDIO:
  76   2                  #if defined(USBFS_ENABLE_AUDIO_CLASS)
                              requestHandled = USBFS_DispatchAUDIOClassRqst();
                          #endif /* USBFS_CLASS_AUDIO */
  79   2                  break;
  80   2              case USBFS_CLASS_CDC:
  81   2                  #if defined(USBFS_ENABLE_CDC_CLASS)
                              requestHandled = USBFS_DispatchCDCClassRqst();
                          #endif /* USBFS_ENABLE_CDC_CLASS */
  84   2                  break;
  85   2              default:    /* requestHandled is initialized as FALSE by default */
  86   2                  break;
  87   2          }
  88   1      
  89   1          /* `#START USER_DEFINED_CLASS_CODE` Place your Class request here */
  90   1      
  91   1          /* `#END` */
  92   1      
  93   1          #ifdef USBFS_DISPATCH_CLASS_RQST_CALLBACK
                      USBFS_DispatchClassRqst_Callback();
                  #endif /* USBFS_DISPATCH_CLASS_RQST_CALLBACK */
  96   1      
  97   1          return(requestHandled);
  98   1      }
  99          
 100          
 101          /*******************************************************************************
 102          * Additional user functions supporting Class Specific Requests
 103          ********************************************************************************/
 104          
 105          /* `#START CLASS_SPECIFIC_FUNCTIONS` Place any additional functions here */
 106          
 107          /* `#END` */
 108          
 109          #endif /* USBFS_EXTERN_CLS */
 110          
 111          
 112          /* [] END OF FILE */
C51 COMPILER V9.51   USBFS_CLS                                                             02/02/2016 10:48:32 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION USBFS_DispatchClassRqst (BEGIN)
                                           ; SOURCE LINE # 49
                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#requestHandled
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 52
;---- Variable 'interfaceNumber' assigned to Register 'R7' ----
0005 FF                MOV     R7,A
                                           ; SOURCE LINE # 54
0006 906000            MOV     DPTR,#06000H
0009 E0                MOVX    A,@DPTR
000A 5403              ANL     A,#03H
000C 24FE              ADD     A,#0FEH
000E 600A              JZ      ?C0003
0010 04                INC     A
0011 701C              JNZ     ?C0001
                                           ; SOURCE LINE # 55
                                           ; SOURCE LINE # 56
0013         ?C0002:
                                           ; SOURCE LINE # 57
0013 906004            MOV     DPTR,#06004H
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
                                           ; SOURCE LINE # 58
0018 8015              SJMP    ?C0001
                                           ; SOURCE LINE # 59
001A         ?C0003:
                                           ; SOURCE LINE # 61
001A 906004            MOV     DPTR,#06004H
001D E0                MOVX    A,@DPTR
001E 547F              ANL     A,#07FH
0020 75F00B            MOV     B,#0BH
0023 A4                MUL     AB
0024 2400        E     ADD     A,#LOW USBFS_EP+0AH
0026 F582              MOV     DPL,A
0028 E4                CLR     A
0029 3400        E     ADDC    A,#HIGH USBFS_EP+0AH
002B F583              MOV     DPH,A
002D E0                MOVX    A,@DPTR
002E FF                MOV     R7,A
                                           ; SOURCE LINE # 63
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 65
                                           ; SOURCE LINE # 66
002F         ?C0001:
                                           ; SOURCE LINE # 68
002F 900000      E     MOV     DPTR,#USBFS_interfaceClass
0032 E0                MOVX    A,@DPTR
0033 FC                MOV     R4,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 2F                ADD     A,R7
0037 F582              MOV     DPL,A
0039 E4                CLR     A
003A 3C                ADDC    A,R4
003B F583              MOV     DPH,A
003D E4                CLR     A
C51 COMPILER V9.51   USBFS_CLS                                                             02/02/2016 10:48:32 PAGE 4   

003E 93                MOVC    A,@A+DPTR
003F 24FD              ADD     A,#0FDH
0041 7008              JNZ     ?C0005
                                           ; SOURCE LINE # 69
                                           ; SOURCE LINE # 70
0043         ?C0006:
                                           ; SOURCE LINE # 72
0043 120000      E     LCALL   USBFS_DispatchHIDClassRqst
0046 900000      R     MOV     DPTR,#requestHandled
0049 EF                MOV     A,R7
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 79
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 84
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
004B         ?C0005:
                                           ; SOURCE LINE # 97
004B 900000      R     MOV     DPTR,#requestHandled
004E E0                MOVX    A,@DPTR
004F FF                MOV     R7,A
                                           ; SOURCE LINE # 98
0050         ?C0010:
0050 22                RET     
             ; FUNCTION USBFS_DispatchClassRqst (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     81    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
