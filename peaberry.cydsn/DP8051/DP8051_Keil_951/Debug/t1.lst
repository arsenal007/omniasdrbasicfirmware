C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE T1
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\t1.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\t1.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB WL(2) PR(.\DP8051\DP8051_Keil_951\Deb
                    -ug/t1.lst) CD OT(5,SIZE) OJ(.\DP8051\DP8051_Keil_951\Debug\t1.obj)

line level    source

   1          // Copyright 2013 David Turnbull AE9RB
   2          //
   3          // Licensed under the Apache License, Version 2.0 (the "License");
   4          // you may not use this file except in compliance with the License.
   5          // You may obtain a copy of the License at
   6          //
   7          //     http://www.apache.org/licenses/LICENSE-2.0
   8          //
   9          // Unless required by applicable law or agreed to in writing, software
  10          // distributed under the License is distributed on an "AS IS" BASIS,
  11          // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  12          // See the License for the specific language governing permissions and
  13          // limitations under the License.
  14          // 09/30/2014 Additions to support low latency CW and Iambic funtionality  Ron Patton / W4MMP
  15          // 01/01/2015 Added Semi Break-in Support Ron Patton / W4MMP
  16          
  17          #include <peaberry.h>
  18          
  19          // Full support for Elecraft T1 Automatic Antenna Tuner
  20          
  21          uint8 T1_Band_Number;
  22          uint8 T1_Tune_Request;
  23          
  24          void T1_Main(void) {
  25   1          static uint8 state = 0, timer, band, send, bits, band_request, band_request_timer;
  26   1          static uint16 tune_timer; 
  27   1          
  28   1          if (tune_timer) {
  29   2              tune_timer--;
  30   2              if (!tune_timer) {
  31   3                  Control_Write(Control_Read() & ~CONTROL_ATU_1);
  32   3              }
  33   2          }
  34   1      
  35   1          if (band_request_timer) band_request_timer--;
  36   1          else if (T1_Band_Number != band) {
  37   2              band_request = 1;
  38   2              band_request_timer = 200;
  39   2          }
  40   1      
  41   1          switch(state) {
  42   2          case 0: // idle
  43   2              if (Status_Read() & STATUS_ATU_0) timer++;
  44   2              else {
  45   3                  if (timer >= 85 && timer <= 115) {
  46   4                      state = 1;
  47   4                      timer = 20;
  48   4                      send = band = T1_Band_Number;
  49   4                      bits = 4;
  50   4                      Control_Write(Control_Read() & ~CONTROL_ATU_0 | CONTROL_ATU_0_OE);
  51   4                  }
  52   3                  else {
  53   4                      timer = 0;
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 2   

  54   4                      if (band_request || T1_Tune_Request) {
  55   5                          Control_Write(Control_Read() | CONTROL_ATU_1);
  56   5                          if (T1_Tune_Request) tune_timer = 1000;
  57   5                          else tune_timer = 10;
  58   5                          band_request = T1_Tune_Request = 0;
  59   5                      }
  60   4                  }
  61   3              }
  62   2              break;
  63   2          case 1: // data low
  64   2              timer--;
  65   2              if (!timer) {
  66   3                  if (bits) {
  67   4                      Control_Write(Control_Read() | CONTROL_ATU_0);
  68   4                      if (send & 0x08) timer = 8;
  69   4                      else timer = 3;
  70   4                      send <<= 1;
  71   4                      bits--;
  72   4                      state = 2;
  73   4                  } else {
  74   4                      Control_Write(Control_Read() & ~(CONTROL_ATU_0 | CONTROL_ATU_0_OE));
  75   4                      state = 0;
  76   4                  }
  77   3              }
  78   2              break;
  79   2          case 2: // data high
  80   2              timer--;
  81   2              if (!timer) {
  82   3                  if (bits) timer = 3;
  83   3                  else timer = 10;
  84   3                  Control_Write(Control_Read() & ~CONTROL_ATU_0);
  85   3                  state = 1;
  86   3              }
  87   2              break;
  88   2          }   
  89   1      
  90   1      }
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION T1_Main (BEGIN)
                                           ; SOURCE LINE # 24
                                           ; SOURCE LINE # 28
0000 900000      R     MOV     DPTR,#tune_timer
0003 E0                MOVX    A,@DPTR
0004 7002              JNZ     ?C0027
0006 A3                INC     DPTR
0007 E0                MOVX    A,@DPTR
0008         ?C0027:
0008 601E              JZ      ?C0001
                                           ; SOURCE LINE # 29
000A 900000      R     MOV     DPTR,#tune_timer
000D 74FF              MOV     A,#0FFH
000F F5F0              MOV     B,A
0011 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 30
0014 900000      R     MOV     DPTR,#tune_timer
0017 E0                MOVX    A,@DPTR
0018 7002              JNZ     ?C0028
001A A3                INC     DPTR
001B E0                MOVX    A,@DPTR
001C         ?C0028:
001C 700A              JNZ     ?C0001
                                           ; SOURCE LINE # 31
001E 120000      E     LCALL   Control_Read
0021 EF                MOV     A,R7
0022 547F              ANL     A,#07FH
0024 FF                MOV     R7,A
0025 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 32
                                           ; SOURCE LINE # 33
0028         ?C0001:
                                           ; SOURCE LINE # 35
0028 900000      R     MOV     DPTR,#band_request_timer
002B E0                MOVX    A,@DPTR
002C 6004              JZ      ?C0003
002E 14                DEC     A
002F F0                MOVX    @DPTR,A
0030 8016              SJMP    ?C0004
0032         ?C0003:
                                           ; SOURCE LINE # 36
0032 900000      R     MOV     DPTR,#band
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 900000      R     MOV     DPTR,#T1_Band_Number
003A E0                MOVX    A,@DPTR
003B 6F                XRL     A,R7
003C 600A              JZ      ?C0004
                                           ; SOURCE LINE # 37
003E 900000      R     MOV     DPTR,#band_request
0041 7401              MOV     A,#01H
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 38
0044 A3                INC     DPTR
0045 74C8              MOV     A,#0C8H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 39
0048         ?C0004:
                                           ; SOURCE LINE # 41
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 4   

0048 900000      R     MOV     DPTR,#state
004B E0                MOVX    A,@DPTR
004C 14                DEC     A
004D 7003              JNZ     $ + 5H
004F 020000      R     LJMP    ?C0016
0052 14                DEC     A
0053 7003              JNZ     $ + 5H
0055 020000      R     LJMP    ?C0022
0058 2402              ADD     A,#02H
005A 6003              JZ      $ + 5H
005C 020000      R     LJMP    ?C0026
                                           ; SOURCE LINE # 42
005F         ?C0007:
                                           ; SOURCE LINE # 43
005F 120000      E     LCALL   Status_Read
0062 EF                MOV     A,R7
0063 30E407            JNB     ACC.4,?C0008
0066 900000      R     MOV     DPTR,#timer
0069 E0                MOVX    A,@DPTR
006A 04                INC     A
006B F0                MOVX    @DPTR,A
006C 22                RET     
006D         ?C0008:
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
006D 900000      R     MOV     DPTR,#timer
0070 E0                MOVX    A,@DPTR
0071 FF                MOV     R7,A
0072 C3                CLR     C
0073 9455              SUBB    A,#055H
0075 402B              JC      ?C0010
0077 EF                MOV     A,R7
0078 D3                SETB    C
0079 9473              SUBB    A,#073H
007B 5025              JNC     ?C0010
                                           ; SOURCE LINE # 46
007D 900000      R     MOV     DPTR,#state
0080 7401              MOV     A,#01H
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 47
0083 A3                INC     DPTR
0084 7414              MOV     A,#014H
0086 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 48
0087 900000      R     MOV     DPTR,#T1_Band_Number
008A E0                MOVX    A,@DPTR
008B 900000      R     MOV     DPTR,#band
008E F0                MOVX    @DPTR,A
008F A3                INC     DPTR
0090 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 49
0091 A3                INC     DPTR
0092 7404              MOV     A,#04H
0094 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 50
0095 120000      E     LCALL   Control_Read
0098 EF                MOV     A,R7
0099 54DF              ANL     A,#0DFH
009B 4440              ORL     A,#040H
009D FF                MOV     R7,A
009E 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 51
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 5   

00A1 22                RET     
00A2         ?C0010:
                                           ; SOURCE LINE # 52
                                           ; SOURCE LINE # 53
00A2 E4                CLR     A
00A3 900000      R     MOV     DPTR,#timer
00A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 54
00A7 900000      R     MOV     DPTR,#band_request
00AA E0                MOVX    A,@DPTR
00AB 7009              JNZ     ?C0013
00AD 900000      R     MOV     DPTR,#T1_Tune_Request
00B0 E0                MOVX    A,@DPTR
00B1 7003              JNZ     $ + 5H
00B3 020000      R     LJMP    ?C0026
00B6         ?C0013:
                                           ; SOURCE LINE # 55
00B6 120000      E     LCALL   Control_Read
00B9 EF                MOV     A,R7
00BA 4480              ORL     A,#080H
00BC FF                MOV     R7,A
00BD 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 56
00C0 900000      R     MOV     DPTR,#T1_Tune_Request
00C3 E0                MOVX    A,@DPTR
00C4 600C              JZ      ?C0014
00C6 900000      R     MOV     DPTR,#tune_timer
00C9 7403              MOV     A,#03H
00CB F0                MOVX    @DPTR,A
00CC A3                INC     DPTR
00CD 74E8              MOV     A,#0E8H
00CF F0                MOVX    @DPTR,A
00D0 8009              SJMP    ?C0015
00D2         ?C0014:
                                           ; SOURCE LINE # 57
00D2 900000      R     MOV     DPTR,#tune_timer
00D5 E4                CLR     A
00D6 F0                MOVX    @DPTR,A
00D7 A3                INC     DPTR
00D8 740A              MOV     A,#0AH
00DA F0                MOVX    @DPTR,A
00DB         ?C0015:
                                           ; SOURCE LINE # 58
00DB E4                CLR     A
00DC 900000      R     MOV     DPTR,#T1_Tune_Request
00DF F0                MOVX    @DPTR,A
00E0 900000      R     MOV     DPTR,#band_request
00E3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 61
                                           ; SOURCE LINE # 62
00E4 22                RET     
                                           ; SOURCE LINE # 63
00E5         ?C0016:
                                           ; SOURCE LINE # 64
00E5 900000      R     MOV     DPTR,#timer
00E8 E0                MOVX    A,@DPTR
00E9 14                DEC     A
00EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 65
00EB E0                MOVX    A,@DPTR
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 6   

00EC 7075              JNZ     ?C0026
                                           ; SOURCE LINE # 66
00EE 900000      R     MOV     DPTR,#bits
00F1 E0                MOVX    A,@DPTR
00F2 6032              JZ      ?C0018
                                           ; SOURCE LINE # 67
00F4 120000      E     LCALL   Control_Read
00F7 EF                MOV     A,R7
00F8 4420              ORL     A,#020H
00FA FF                MOV     R7,A
00FB 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 68
00FE 900000      R     MOV     DPTR,#send
0101 E0                MOVX    A,@DPTR
0102 FF                MOV     R7,A
0103 30E308            JNB     ACC.3,?C0019
0106 900000      R     MOV     DPTR,#timer
0109 7408              MOV     A,#08H
010B F0                MOVX    @DPTR,A
010C 8006              SJMP    ?C0020
010E         ?C0019:
                                           ; SOURCE LINE # 69
010E 900000      R     MOV     DPTR,#timer
0111 7403              MOV     A,#03H
0113 F0                MOVX    @DPTR,A
0114         ?C0020:
                                           ; SOURCE LINE # 70
0114 EF                MOV     A,R7
0115 25E0              ADD     A,ACC
0117 900000      R     MOV     DPTR,#send
011A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 71
011B A3                INC     DPTR
011C E0                MOVX    A,@DPTR
011D 14                DEC     A
011E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 72
011F 900000      R     MOV     DPTR,#state
0122 7402              MOV     A,#02H
0124 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 73
0125 22                RET     
0126         ?C0018:
                                           ; SOURCE LINE # 74
0126 120000      E     LCALL   Control_Read
0129 EF                MOV     A,R7
012A 549F              ANL     A,#09FH
012C FF                MOV     R7,A
012D 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 75
0130 E4                CLR     A
0131 900000      R     MOV     DPTR,#state
0134 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 76
                                           ; SOURCE LINE # 77
                                           ; SOURCE LINE # 78
0135 22                RET     
                                           ; SOURCE LINE # 79
0136         ?C0022:
                                           ; SOURCE LINE # 80
0136 900000      R     MOV     DPTR,#timer
0139 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   T1                                                                    10/22/2015 22:07:34 PAGE 7   

013A 14                DEC     A
013B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 81
013C E0                MOVX    A,@DPTR
013D 7024              JNZ     ?C0026
                                           ; SOURCE LINE # 82
013F 900000      R     MOV     DPTR,#bits
0142 E0                MOVX    A,@DPTR
0143 6008              JZ      ?C0024
0145 900000      R     MOV     DPTR,#timer
0148 7403              MOV     A,#03H
014A F0                MOVX    @DPTR,A
014B 8006              SJMP    ?C0025
014D         ?C0024:
                                           ; SOURCE LINE # 83
014D 900000      R     MOV     DPTR,#timer
0150 740A              MOV     A,#0AH
0152 F0                MOVX    @DPTR,A
0153         ?C0025:
                                           ; SOURCE LINE # 84
0153 120000      E     LCALL   Control_Read
0156 EF                MOV     A,R7
0157 54DF              ANL     A,#0DFH
0159 FF                MOV     R7,A
015A 120000      E     LCALL   _Control_Write
                                           ; SOURCE LINE # 85
015D 900000      R     MOV     DPTR,#state
0160 7401              MOV     A,#01H
0162 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 90
0163         ?C0026:
0163 22                RET     
             ; FUNCTION T1_Main (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    356    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     11    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
