C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE PCM3060
OBJECT MODULE PLACED IN .\DP8051\DP8051_Keil_951\Debug\pcm3060.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\3.3\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -.\pcm3060.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB WL(2) PR(.\DP8051\DP8051_Keil_95
                    -1\Debug/pcm3060.lst) CD OT(5,SIZE) OJ(.\DP8051\DP8051_Keil_951\Debug\pcm3060.obj)

line level    source

   1          // Copyright 2013 David Turnbull AE9RB
   2          //
   3          // Licensed under the Apache License, Version 2.0 (the "License");
   4          // you may not use this file except in compliance with the License.
   5          // You may obtain a copy of the License at
   6          //
   7          //     http://www.apache.org/licenses/LICENSE-2.0
   8          //
   9          // Unless required by applicable law or agreed to in writing, software
  10          // distributed under the License is distributed on an "AS IS" BASIS,
  11          // WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  12          // See the License for the specific language governing permissions and
  13          // limitations under the License.
  14          // 09/30/2014 Additions to support low latency CW and Iambic funtionality  Ron Patton / W4MMP
  15          // 01/01/2015 Added Semi Break-in Support Ron Patton / W4MMP
  16          
  17          #include <peaberry.h>
  18          
  19          #define PCM3060_I2C_ADDR 0x46
  20          #define USB_AUDIO_BUFS 3
  21          
  22          volatile uint8 RxI2S[USB_AUDIO_BUFS][I2S_BUF_SIZE], RxI2S_Stage;
  23          volatile uint8 TxI2S[USB_AUDIO_BUFS][I2S_BUF_SIZE], TxI2S_Stage, TxI2S_Zero = 0;
  24          
  25          uint8 RxI2S_Stage_TD[3], RxI2S_Buff_TD[USB_AUDIO_BUFS];
  26          
  27          void DmaRxInit() {
  28   1          uint8 i;
  29   1          RxI2S_Stage_DmaInitialize(1, 1, HI16(CYDEV_PERIPH_BASE), HI16(CYDEV_SRAM_BASE));
  30   1          RxI2S_Buff_DmaInitialize(1, 1, HI16(CYDEV_SRAM_BASE), HI16(CYDEV_SRAM_BASE));
  31   1          for (i=0; i < 3; i++) RxI2S_Stage_TD[i]=CyDmaTdAllocate();
  32   1          for (i=0; i < USB_AUDIO_BUFS; i++) RxI2S_Buff_TD[i]=CyDmaTdAllocate();
  33   1      }
  34          
  35          void DmaRxStart(void) {
  36   1          uint8 i, n;
  37   1      
  38   1          for (i=0; i < 3; i++) {
  39   2              if (i==2) {
  40   3                  CyDmaTdSetConfiguration(RxI2S_Stage_TD[i], 1, RxI2S_Stage_TD[0], 0 );
  41   3              } else {
  42   3                  CyDmaTdSetConfiguration(RxI2S_Stage_TD[i], 1, RxI2S_Stage_TD[i+1], RxI2S_Stage__TD_TERMOUT_EN 
             -);
  43   3              }
  44   2              CyDmaTdSetAddress(RxI2S_Stage_TD[i], LO16((uint32)I2S_RX_FIFO_0_PTR), LO16((uint32)&RxI2S_Stage));
  45   2          }
  46   1          CyDmaClearPendingDrq(RxI2S_Stage_DmaHandle);
  47   1          CyDmaChSetInitialTd(RxI2S_Stage_DmaHandle, RxI2S_Stage_TD[0]);
  48   1      
  49   1          for (i=0; i < USB_AUDIO_BUFS; i++) {
  50   2              n = i + 1;
  51   2              if (n >= USB_AUDIO_BUFS) n=0;
  52   2              CyDmaTdSetConfiguration(RxI2S_Buff_TD[i], I2S_BUF_SIZE, RxI2S_Buff_TD[n], TD_INC_DST_ADR);
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 2   

  53   2              CyDmaTdSetAddress(RxI2S_Buff_TD[i], LO16((uint32)&RxI2S_Stage), LO16((uint32)RxI2S[i]));
  54   2          }
  55   1          CyDmaClearPendingDrq(RxI2S_Buff_DmaHandle);
  56   1          CyDmaChSetInitialTd(RxI2S_Buff_DmaHandle, RxI2S_Buff_TD[0]);
  57   1      
  58   1          CyDmaChEnable(RxI2S_Buff_DmaHandle, 1u);
  59   1          CyDmaChEnable(RxI2S_Stage_DmaHandle, 1u);
  60   1      }
  61          
  62          
  63          uint8 TxI2S_Stage_TD[3], TxI2S_Buff_TD[USB_AUDIO_BUFS], TxI2S_Zero_TD[USB_AUDIO_BUFS];
  64          
  65          void DmaTxInit() {
  66   1          uint8 i;
  67   1          TxI2S_Buff_DmaInitialize(1, 1, HI16(CYDEV_SRAM_BASE), HI16(CYDEV_SRAM_BASE));
  68   1          TxI2S_Stage_DmaInitialize(1, 1, HI16(CYDEV_SRAM_BASE), HI16(CYDEV_PERIPH_BASE));
  69   1          TxI2S_Zero_DmaInitialize(1, 1, HI16(CYDEV_SRAM_BASE), HI16(CYDEV_SRAM_BASE));
  70   1          for (i=0; i < 3; i++) TxI2S_Stage_TD[i]=CyDmaTdAllocate();
  71   1          for (i=0; i < USB_AUDIO_BUFS; i++) TxI2S_Buff_TD[i]=CyDmaTdAllocate();
  72   1          for (i=0; i < USB_AUDIO_BUFS; i++) TxI2S_Zero_TD[i]=CyDmaTdAllocate();
  73   1      }
  74          
  75          void DmaTxStart(void) {
  76   1          uint8 i, n;
  77   1          
  78   1          for (i=0; i < 3; i++) {
  79   2              if (i==2) {
  80   3                  CyDmaTdSetConfiguration(TxI2S_Stage_TD[i], 1, TxI2S_Stage_TD[0], 0 );
  81   3                  CyDmaTdSetAddress(TxI2S_Stage_TD[i], LO16((uint32)&TxI2S_Zero), LO16((uint32)I2S_TX_FIFO_0_PTR
             -));
  82   3              } else {
  83   3                  CyDmaTdSetConfiguration(TxI2S_Stage_TD[i], 1, TxI2S_Stage_TD[i+1], TxI2S_Stage__TD_TERMOUT_EN 
             -);
  84   3                  CyDmaTdSetAddress(TxI2S_Stage_TD[i], LO16((uint32)&TxI2S_Stage), LO16((uint32)I2S_TX_FIFO_0_PT
             -R));
  85   3              }
  86   2          }
  87   1          CyDmaClearPendingDrq(TxI2S_Stage_DmaHandle);
  88   1          CyDmaChSetInitialTd(TxI2S_Stage_DmaHandle, TxI2S_Stage_TD[0]);
  89   1          
  90   1          for (i=0; i < USB_AUDIO_BUFS; i++) {
  91   2              n = i + 1;
  92   2              if (n >= USB_AUDIO_BUFS) {
  93   3                  n=0;
  94   3                  CyDmaTdSetConfiguration(TxI2S_Buff_TD[i], I2S_BUF_SIZE, TxI2S_Buff_TD[n], TD_INC_SRC_ADR | TxI
             -2S_Buff__TD_TERMOUT_EN);    
  95   3              } else {
  96   3                  CyDmaTdSetConfiguration(TxI2S_Buff_TD[i], I2S_BUF_SIZE, TxI2S_Buff_TD[n], TD_INC_SRC_ADR);    
  97   3              }
  98   2              CyDmaTdSetAddress(TxI2S_Buff_TD[i], LO16((uint32)TxI2S[i]), LO16((uint32)&TxI2S_Stage));
  99   2              CyDmaTdSetConfiguration(TxI2S_Zero_TD[i], I2S_BUF_SIZE, TxI2S_Zero_TD[n], TD_INC_DST_ADR );
 100   2              CyDmaTdSetAddress(TxI2S_Zero_TD[i], LO16((uint32)&TxI2S_Zero), LO16((uint32)TxI2S[i]));
 101   2          }
 102   1          CyDmaClearPendingDrq(TxI2S_Buff_DmaHandle);
 103   1          CyDmaChSetInitialTd(TxI2S_Buff_DmaHandle, TxI2S_Buff_TD[0]);
 104   1          CyDmaClearPendingDrq(TxI2S_Zero_DmaHandle);
 105   1          CyDmaChSetInitialTd(TxI2S_Zero_DmaHandle, TxI2S_Zero_TD[0]);
 106   1      
 107   1          CyDmaChEnable(TxI2S_Zero_DmaHandle, 1u);
 108   1          CyDmaChSetRequest(TxI2S_Buff_DmaHandle, CPU_REQ);
 109   1          CyDmaChEnable(TxI2S_Buff_DmaHandle, 1u);
 110   1          CyDmaChEnable(TxI2S_Stage_DmaHandle, 1u);
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 3   

 111   1      }
 112          
 113          uint8* PCM3060_TxBuf(void) {
 114   1          return TxI2S[SyncSOF_USB_Buffer()];
 115   1      }
 116          
 117          uint8* PCM3060_RxBuf(void) {
 118   1          return RxI2S[SyncSOF_USB_Buffer()];
 119   1      }
 120          
 121          uint8 PCM3060_SetRegister(uint8 reg, uint8 val) {
 122   1          uint8 pcm3060_cmd[2], i, state = 0;
 123   1          uint16 err = 0;
 124   1      
 125   1          while (state < 2) {
 126   2              switch (state) {
 127   3              case 0:
 128   3                  pcm3060_cmd[0] = reg;
 129   3                  pcm3060_cmd[1] = val;
 130   3                  I2C_MasterWriteBuf(PCM3060_I2C_ADDR, pcm3060_cmd, 2, I2C_MODE_COMPLETE_XFER);
 131   3                  state++;
 132   3                  break;
 133   3              case 1:
 134   3                  i = I2C_MasterStatus();
 135   3                  if (i & I2C_MSTAT_ERR_XFER) {
 136   4                      state--;
 137   4                  } else if (i & I2C_MSTAT_WR_CMPLT) {
 138   4                      state++;
 139   4                  }
 140   3                  if (!--err) return 1;
 141   3                  break;
 142   3              }
 143   2          }
 144   1          return 0;
 145   1      }
 146          
 147          uint8 PCM3060_Init(void) {
 148   1          I2S_Start();
 149   1          DmaRxInit();
 150   1          DmaTxInit();
 151   1          return PCM3060_Stop();
 152   1      }
 153          
 154          void PCM3060_Start(void) {
 155   1          PCM3060_SetRegister(0x40, 0xC0); // Wakeup
 156   1          PCM3060_SetRegister(0x45, 0x80); // Slow rolloff filter
 157   1          DmaRxStart();
 158   1          DmaTxStart();
 159   1          I2S_EnableRx();
 160   1          I2S_EnableTx();
 161   1      }
 162          
 163          
 164          uint8 PCM3060_Stop(void) {
 165   1          uint8 ret;
 166   1          ret = PCM3060_SetRegister(0x40, 0xF0); // Sleep
 167   1          I2S_DisableRx();
 168   1          I2S_DisableTx();
 169   1          CyDmaChDisable(RxI2S_Stage_DmaHandle);
 170   1          CyDmaChDisable(RxI2S_Buff_DmaHandle);
 171   1          CyDmaChDisable(TxI2S_Stage_DmaHandle);
 172   1          CyDmaChDisable(TxI2S_Buff_DmaHandle);
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 4   

 173   1          CyDmaChDisable(TxI2S_Zero_DmaHandle);
 174   1          I2S_ClearRxFIFO();
 175   1          I2S_ClearTxFIFO();
 176   1          return ret;
 177   1      }
 178          
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 5   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION DmaRxInit (BEGIN)
                                           ; SOURCE LINE # 27
                                           ; SOURCE LINE # 29
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#?_RxI2S_Stage_DmaInitialize?BYTE+04H
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 FB                MOV     R3,A
0008 FA                MOV     R2,A
0009 7D01              MOV     R5,#01H
000B 7F01              MOV     R7,#01H
000D 120000      E     LCALL   _RxI2S_Stage_DmaInitialize
                                           ; SOURCE LINE # 30
0010 E4                CLR     A
0011 900000      E     MOV     DPTR,#?_RxI2S_Buff_DmaInitialize?BYTE+04H
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 F0                MOVX    @DPTR,A
0017 FB                MOV     R3,A
0018 FA                MOV     R2,A
0019 7D01              MOV     R5,#01H
001B 7F01              MOV     R7,#01H
001D 120000      E     LCALL   _RxI2S_Buff_DmaInitialize
                                           ; SOURCE LINE # 31
0020 E4                CLR     A
0021 900000      R     MOV     DPTR,#i
0024 F0                MOVX    @DPTR,A
0025         ?C0001:
0025 900000      R     MOV     DPTR,#i
0028 E0                MOVX    A,@DPTR
0029 C3                CLR     C
002A 9403              SUBB    A,#03H
002C 501A              JNC     ?C0002
002E 120000      E     LCALL   CyDmaTdAllocate
0031 900000      R     MOV     DPTR,#i
0034 E0                MOVX    A,@DPTR
0035 2400        R     ADD     A,#LOW RxI2S_Stage_TD
0037 F582              MOV     DPL,A
0039 E4                CLR     A
003A 3400        R     ADDC    A,#HIGH RxI2S_Stage_TD
003C F583              MOV     DPH,A
003E EF                MOV     A,R7
003F F0                MOVX    @DPTR,A
0040 900000      R     MOV     DPTR,#i
0043 E0                MOVX    A,@DPTR
0044 04                INC     A
0045 F0                MOVX    @DPTR,A
0046 80DD              SJMP    ?C0001
0048         ?C0002:
                                           ; SOURCE LINE # 32
0048 E4                CLR     A
0049 900000      R     MOV     DPTR,#i
004C F0                MOVX    @DPTR,A
004D         ?C0004:
004D 900000      R     MOV     DPTR,#i
0050 E0                MOVX    A,@DPTR
0051 C3                CLR     C
0052 9403              SUBB    A,#03H
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 6   

0054 501A              JNC     ?C0007
0056 120000      E     LCALL   CyDmaTdAllocate
0059 900000      R     MOV     DPTR,#i
005C E0                MOVX    A,@DPTR
005D 2400        R     ADD     A,#LOW RxI2S_Buff_TD
005F F582              MOV     DPL,A
0061 E4                CLR     A
0062 3400        R     ADDC    A,#HIGH RxI2S_Buff_TD
0064 F583              MOV     DPH,A
0066 EF                MOV     A,R7
0067 F0                MOVX    @DPTR,A
0068 900000      R     MOV     DPTR,#i
006B E0                MOVX    A,@DPTR
006C 04                INC     A
006D F0                MOVX    @DPTR,A
006E 80DD              SJMP    ?C0004
                                           ; SOURCE LINE # 33
0070         ?C0007:
0070 22                RET     
             ; FUNCTION DmaRxInit (END)

             ; FUNCTION DmaRxStart (BEGIN)
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 38
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
0005         ?C0008:
0005 900000      R     MOV     DPTR,#i
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A C3                CLR     C
000B 9403              SUBB    A,#03H
000D 5073              JNC     ?C0009
                                           ; SOURCE LINE # 39
000F EF                MOV     A,R7
0010 B4021D            CJNE    A,#02H,?C0011
                                           ; SOURCE LINE # 40
0013 2400        R     ADD     A,#LOW RxI2S_Stage_TD
0015 F582              MOV     DPL,A
0017 E4                CLR     A
0018 3400        R     ADDC    A,#HIGH RxI2S_Stage_TD
001A F583              MOV     DPH,A
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
001E 900000      R     MOV     DPTR,#RxI2S_Stage_TD
0021 E0                MOVX    A,@DPTR
0022 FB                MOV     R3,A
0023 E4                CLR     A
0024 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
0027 F0                MOVX    @DPTR,A
0028 7D01              MOV     R5,#01H
002A FC                MOV     R4,A
002B 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 41
002E 8029              SJMP    ?C0012
0030         ?C0011:
                                           ; SOURCE LINE # 42
0030 900000      R     MOV     DPTR,#i
0033 E0                MOVX    A,@DPTR
0034 FE                MOV     R6,A
0035 2400        R     ADD     A,#LOW RxI2S_Stage_TD
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 7   

0037 F582              MOV     DPL,A
0039 E4                CLR     A
003A 3400        R     ADDC    A,#HIGH RxI2S_Stage_TD
003C F583              MOV     DPH,A
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 7400        R     MOV     A,#LOW RxI2S_Stage_TD+01H
0042 2E                ADD     A,R6
0043 F582              MOV     DPL,A
0045 E4                CLR     A
0046 3400        R     ADDC    A,#HIGH RxI2S_Stage_TD+01H
0048 F583              MOV     DPH,A
004A E0                MOVX    A,@DPTR
004B FB                MOV     R3,A
004C 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
004F 7404              MOV     A,#04H
0051 F0                MOVX    @DPTR,A
0052 7D01              MOV     R5,#01H
0054 7C00              MOV     R4,#00H
0056 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 43
0059         ?C0012:
                                           ; SOURCE LINE # 44
0059 900000      R     MOV     DPTR,#i
005C E0                MOVX    A,@DPTR
005D 2400        R     ADD     A,#LOW RxI2S_Stage_TD
005F F582              MOV     DPL,A
0061 E4                CLR     A
0062 3400        R     ADDC    A,#HIGH RxI2S_Stage_TD
0064 F583              MOV     DPH,A
0066 E0                MOVX    A,@DPTR
0067 FF                MOV     R7,A
0068 7B01              MOV     R3,#01H
006A 7A00        R     MOV     R2,#HIGH RxI2S_Stage
006C 7900        R     MOV     R1,#LOW RxI2S_Stage
006E E9                MOV     A,R1
006F EA                MOV     A,R2
0070 E4                CLR     A
0071 AB01              MOV     R3,AR1
0073 7D43              MOV     R5,#043H
0075 7C64              MOV     R4,#064H
0077 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 45
007A 900000      R     MOV     DPTR,#i
007D E0                MOVX    A,@DPTR
007E 04                INC     A
007F F0                MOVX    @DPTR,A
0080 8083              SJMP    ?C0008
0082         ?C0009:
                                           ; SOURCE LINE # 46
0082 900000      E     MOV     DPTR,#RxI2S_Stage_DmaHandle
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 120000      E     LCALL   _CyDmaClearPendingDrq
                                           ; SOURCE LINE # 47
008A 900000      E     MOV     DPTR,#RxI2S_Stage_DmaHandle
008D E0                MOVX    A,@DPTR
008E FF                MOV     R7,A
008F 900000      R     MOV     DPTR,#RxI2S_Stage_TD
0092 E0                MOVX    A,@DPTR
0093 FD                MOV     R5,A
0094 120000      E     LCALL   _CyDmaChSetInitialTd
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 8   

                                           ; SOURCE LINE # 49
0097 E4                CLR     A
0098 900000      R     MOV     DPTR,#i
009B F0                MOVX    @DPTR,A
009C         ?C0013:
009C 900000      R     MOV     DPTR,#i
009F E0                MOVX    A,@DPTR
00A0 FF                MOV     R7,A
00A1 C3                CLR     C
00A2 9403              SUBB    A,#03H
00A4 4003              JC      $ + 5H
00A6 020000      R     LJMP    ?C0014
                                           ; SOURCE LINE # 50
00A9 EF                MOV     A,R7
00AA 04                INC     A
00AB A3                INC     DPTR
00AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 51
00AD C3                CLR     C
00AE 9403              SUBB    A,#03H
00B0 4002              JC      ?C0016
00B2 E4                CLR     A
00B3 F0                MOVX    @DPTR,A
00B4         ?C0016:
                                           ; SOURCE LINE # 52
00B4 900000      R     MOV     DPTR,#i
00B7 E0                MOVX    A,@DPTR
00B8 2400        R     ADD     A,#LOW RxI2S_Buff_TD
00BA F582              MOV     DPL,A
00BC E4                CLR     A
00BD 3400        R     ADDC    A,#HIGH RxI2S_Buff_TD
00BF F583              MOV     DPH,A
00C1 E0                MOVX    A,@DPTR
00C2 FF                MOV     R7,A
00C3 900000      R     MOV     DPTR,#n
00C6 E0                MOVX    A,@DPTR
00C7 2400        R     ADD     A,#LOW RxI2S_Buff_TD
00C9 F582              MOV     DPL,A
00CB E4                CLR     A
00CC 3400        R     ADDC    A,#HIGH RxI2S_Buff_TD
00CE F583              MOV     DPH,A
00D0 E0                MOVX    A,@DPTR
00D1 FB                MOV     R3,A
00D2 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
00D5 7402              MOV     A,#02H
00D7 F0                MOVX    @DPTR,A
00D8 7D80              MOV     R5,#080H
00DA 7C01              MOV     R4,#01H
00DC 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 53
00DF 900000      R     MOV     DPTR,#i
00E2 E0                MOVX    A,@DPTR
00E3 F9                MOV     R1,A
00E4 75F080            MOV     B,#080H
00E7 900000      R     MOV     DPTR,#RxI2S
00EA 120000      E     LCALL   ?C?OFFXADD
00ED E9                MOV     A,R1
00EE 2583              ADD     A,DPH
00F0 F583              MOV     DPH,A
00F2 FE                MOV     R6,A
00F3 E582              MOV     A,DPL
00F5 EE                MOV     A,R6
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 9   

00F6 E4                CLR     A
00F7 AB82              MOV     R3,DPL
00F9 AA06              MOV     R2,AR6
00FB C002              PUSH    AR2
00FD C003              PUSH    AR3
00FF 7400        R     MOV     A,#LOW RxI2S_Buff_TD
0101 29                ADD     A,R1
0102 F582              MOV     DPL,A
0104 E4                CLR     A
0105 3400        R     ADDC    A,#HIGH RxI2S_Buff_TD
0107 F583              MOV     DPH,A
0109 E0                MOVX    A,@DPTR
010A FF                MOV     R7,A
010B 7B01              MOV     R3,#01H
010D 7A00        R     MOV     R2,#HIGH RxI2S_Stage
010F 7900        R     MOV     R1,#LOW RxI2S_Stage
0111 E9                MOV     A,R1
0112 EA                MOV     A,R2
0113 E4                CLR     A
0114 AD01              MOV     R5,AR1
0116 AC02              MOV     R4,AR2
0118 D003              POP     AR3
011A D002              POP     AR2
011C 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 54
011F 900000      R     MOV     DPTR,#i
0122 E0                MOVX    A,@DPTR
0123 04                INC     A
0124 F0                MOVX    @DPTR,A
0125 020000      R     LJMP    ?C0013
0128         ?C0014:
                                           ; SOURCE LINE # 55
0128 900000      E     MOV     DPTR,#RxI2S_Buff_DmaHandle
012B E0                MOVX    A,@DPTR
012C FF                MOV     R7,A
012D 120000      E     LCALL   _CyDmaClearPendingDrq
                                           ; SOURCE LINE # 56
0130 900000      E     MOV     DPTR,#RxI2S_Buff_DmaHandle
0133 E0                MOVX    A,@DPTR
0134 FF                MOV     R7,A
0135 900000      R     MOV     DPTR,#RxI2S_Buff_TD
0138 E0                MOVX    A,@DPTR
0139 FD                MOV     R5,A
013A 120000      E     LCALL   _CyDmaChSetInitialTd
                                           ; SOURCE LINE # 58
013D 900000      E     MOV     DPTR,#RxI2S_Buff_DmaHandle
0140 E0                MOVX    A,@DPTR
0141 FF                MOV     R7,A
0142 7D01              MOV     R5,#01H
0144 120000      E     LCALL   _CyDmaChEnable
                                           ; SOURCE LINE # 59
0147 900000      E     MOV     DPTR,#RxI2S_Stage_DmaHandle
014A E0                MOVX    A,@DPTR
014B FF                MOV     R7,A
014C 7D01              MOV     R5,#01H
014E 120000      E     LCALL   _CyDmaChEnable
                                           ; SOURCE LINE # 60
0151 22                RET     
             ; FUNCTION DmaRxStart (END)

             ; FUNCTION DmaTxInit (BEGIN)
                                           ; SOURCE LINE # 65
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 10  

                                           ; SOURCE LINE # 67
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#?_TxI2S_Buff_DmaInitialize?BYTE+04H
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 FB                MOV     R3,A
0008 FA                MOV     R2,A
0009 7D01              MOV     R5,#01H
000B 7F01              MOV     R7,#01H
000D 120000      E     LCALL   _TxI2S_Buff_DmaInitialize
                                           ; SOURCE LINE # 68
0010 E4                CLR     A
0011 900000      E     MOV     DPTR,#?_TxI2S_Stage_DmaInitialize?BYTE+04H
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 F0                MOVX    @DPTR,A
0017 FB                MOV     R3,A
0018 FA                MOV     R2,A
0019 7D01              MOV     R5,#01H
001B 7F01              MOV     R7,#01H
001D 120000      E     LCALL   _TxI2S_Stage_DmaInitialize
                                           ; SOURCE LINE # 69
0020 E4                CLR     A
0021 900000      E     MOV     DPTR,#?_TxI2S_Zero_DmaInitialize?BYTE+04H
0024 F0                MOVX    @DPTR,A
0025 A3                INC     DPTR
0026 F0                MOVX    @DPTR,A
0027 FB                MOV     R3,A
0028 FA                MOV     R2,A
0029 7D01              MOV     R5,#01H
002B 7F01              MOV     R7,#01H
002D 120000      E     LCALL   _TxI2S_Zero_DmaInitialize
                                           ; SOURCE LINE # 70
0030 E4                CLR     A
0031 900000      R     MOV     DPTR,#i
0034 F0                MOVX    @DPTR,A
0035         ?C0018:
0035 900000      R     MOV     DPTR,#i
0038 E0                MOVX    A,@DPTR
0039 C3                CLR     C
003A 9403              SUBB    A,#03H
003C 501A              JNC     ?C0019
003E 120000      E     LCALL   CyDmaTdAllocate
0041 900000      R     MOV     DPTR,#i
0044 E0                MOVX    A,@DPTR
0045 2400        R     ADD     A,#LOW TxI2S_Stage_TD
0047 F582              MOV     DPL,A
0049 E4                CLR     A
004A 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD
004C F583              MOV     DPH,A
004E EF                MOV     A,R7
004F F0                MOVX    @DPTR,A
0050 900000      R     MOV     DPTR,#i
0053 E0                MOVX    A,@DPTR
0054 04                INC     A
0055 F0                MOVX    @DPTR,A
0056 80DD              SJMP    ?C0018
0058         ?C0019:
                                           ; SOURCE LINE # 71
0058 E4                CLR     A
0059 900000      R     MOV     DPTR,#i
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 11  

005C F0                MOVX    @DPTR,A
005D         ?C0021:
005D 900000      R     MOV     DPTR,#i
0060 E0                MOVX    A,@DPTR
0061 C3                CLR     C
0062 9403              SUBB    A,#03H
0064 501A              JNC     ?C0022
0066 120000      E     LCALL   CyDmaTdAllocate
0069 900000      R     MOV     DPTR,#i
006C E0                MOVX    A,@DPTR
006D 2400        R     ADD     A,#LOW TxI2S_Buff_TD
006F F582              MOV     DPL,A
0071 E4                CLR     A
0072 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
0074 F583              MOV     DPH,A
0076 EF                MOV     A,R7
0077 F0                MOVX    @DPTR,A
0078 900000      R     MOV     DPTR,#i
007B E0                MOVX    A,@DPTR
007C 04                INC     A
007D F0                MOVX    @DPTR,A
007E 80DD              SJMP    ?C0021
0080         ?C0022:
                                           ; SOURCE LINE # 72
0080 E4                CLR     A
0081 900000      R     MOV     DPTR,#i
0084 F0                MOVX    @DPTR,A
0085         ?C0024:
0085 900000      R     MOV     DPTR,#i
0088 E0                MOVX    A,@DPTR
0089 C3                CLR     C
008A 9403              SUBB    A,#03H
008C 501A              JNC     ?C0027
008E 120000      E     LCALL   CyDmaTdAllocate
0091 900000      R     MOV     DPTR,#i
0094 E0                MOVX    A,@DPTR
0095 2400        R     ADD     A,#LOW TxI2S_Zero_TD
0097 F582              MOV     DPL,A
0099 E4                CLR     A
009A 3400        R     ADDC    A,#HIGH TxI2S_Zero_TD
009C F583              MOV     DPH,A
009E EF                MOV     A,R7
009F F0                MOVX    @DPTR,A
00A0 900000      R     MOV     DPTR,#i
00A3 E0                MOVX    A,@DPTR
00A4 04                INC     A
00A5 F0                MOVX    @DPTR,A
00A6 80DD              SJMP    ?C0024
                                           ; SOURCE LINE # 73
00A8         ?C0027:
00A8 22                RET     
             ; FUNCTION DmaTxInit (END)

             ; FUNCTION DmaTxStart (BEGIN)
                                           ; SOURCE LINE # 75
                                           ; SOURCE LINE # 78
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#i
0004 F0                MOVX    @DPTR,A
0005         ?C0028:
0005 900000      R     MOV     DPTR,#i
0008 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 12  

0009 FF                MOV     R7,A
000A C3                CLR     C
000B 9403              SUBB    A,#03H
000D 4003              JC      $ + 5H
000F 020000      R     LJMP    ?C0029
                                           ; SOURCE LINE # 79
0012 EF                MOV     A,R7
0013 6402              XRL     A,#02H
0015 7041              JNZ     ?C0031
                                           ; SOURCE LINE # 80
0017 E0                MOVX    A,@DPTR
0018 2400        R     ADD     A,#LOW TxI2S_Stage_TD
001A F582              MOV     DPL,A
001C E4                CLR     A
001D 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD
001F F583              MOV     DPH,A
0021 E0                MOVX    A,@DPTR
0022 FF                MOV     R7,A
0023 900000      R     MOV     DPTR,#TxI2S_Stage_TD
0026 E0                MOVX    A,@DPTR
0027 FB                MOV     R3,A
0028 E4                CLR     A
0029 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
002C F0                MOVX    @DPTR,A
002D 7D01              MOV     R5,#01H
002F FC                MOV     R4,A
0030 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 81
0033 900000      R     MOV     DPTR,#i
0036 E0                MOVX    A,@DPTR
0037 2400        R     ADD     A,#LOW TxI2S_Stage_TD
0039 F582              MOV     DPL,A
003B E4                CLR     A
003C 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD
003E F583              MOV     DPH,A
0040 E0                MOVX    A,@DPTR
0041 FF                MOV     R7,A
0042 7B01              MOV     R3,#01H
0044 7A00        R     MOV     R2,#HIGH TxI2S_Zero
0046 7900        R     MOV     R1,#LOW TxI2S_Zero
0048 E9                MOV     A,R1
0049 EA                MOV     A,R2
004A E4                CLR     A
004B AD01              MOV     R5,AR1
004D AC02              MOV     R4,AR2
004F 7B47              MOV     R3,#047H
0051 7A64              MOV     R2,#064H
0053 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 82
0056 804C              SJMP    ?C0030
0058         ?C0031:
                                           ; SOURCE LINE # 83
0058 900000      R     MOV     DPTR,#i
005B E0                MOVX    A,@DPTR
005C FE                MOV     R6,A
005D 2400        R     ADD     A,#LOW TxI2S_Stage_TD
005F F582              MOV     DPL,A
0061 E4                CLR     A
0062 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD
0064 F583              MOV     DPH,A
0066 E0                MOVX    A,@DPTR
0067 FF                MOV     R7,A
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 13  

0068 7400        R     MOV     A,#LOW TxI2S_Stage_TD+01H
006A 2E                ADD     A,R6
006B F582              MOV     DPL,A
006D E4                CLR     A
006E 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD+01H
0070 F583              MOV     DPH,A
0072 E0                MOVX    A,@DPTR
0073 FB                MOV     R3,A
0074 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
0077 7404              MOV     A,#04H
0079 F0                MOVX    @DPTR,A
007A 7D01              MOV     R5,#01H
007C 7C00              MOV     R4,#00H
007E 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 84
0081 900000      R     MOV     DPTR,#i
0084 E0                MOVX    A,@DPTR
0085 2400        R     ADD     A,#LOW TxI2S_Stage_TD
0087 F582              MOV     DPL,A
0089 E4                CLR     A
008A 3400        R     ADDC    A,#HIGH TxI2S_Stage_TD
008C F583              MOV     DPH,A
008E E0                MOVX    A,@DPTR
008F FF                MOV     R7,A
0090 7B01              MOV     R3,#01H
0092 7A00        R     MOV     R2,#HIGH TxI2S_Stage
0094 7900        R     MOV     R1,#LOW TxI2S_Stage
0096 E9                MOV     A,R1
0097 EA                MOV     A,R2
0098 E4                CLR     A
0099 AD01              MOV     R5,AR1
009B AC02              MOV     R4,AR2
009D 7B47              MOV     R3,#047H
009F 7A64              MOV     R2,#064H
00A1 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 86
00A4         ?C0030:
00A4 900000      R     MOV     DPTR,#i
00A7 E0                MOVX    A,@DPTR
00A8 04                INC     A
00A9 F0                MOVX    @DPTR,A
00AA 020000      R     LJMP    ?C0028
00AD         ?C0029:
                                           ; SOURCE LINE # 87
00AD 900000      E     MOV     DPTR,#TxI2S_Stage_DmaHandle
00B0 E0                MOVX    A,@DPTR
00B1 FF                MOV     R7,A
00B2 120000      E     LCALL   _CyDmaClearPendingDrq
                                           ; SOURCE LINE # 88
00B5 900000      E     MOV     DPTR,#TxI2S_Stage_DmaHandle
00B8 E0                MOVX    A,@DPTR
00B9 FF                MOV     R7,A
00BA 900000      R     MOV     DPTR,#TxI2S_Stage_TD
00BD E0                MOVX    A,@DPTR
00BE FD                MOV     R5,A
00BF 120000      E     LCALL   _CyDmaChSetInitialTd
                                           ; SOURCE LINE # 90
00C2 E4                CLR     A
00C3 900000      R     MOV     DPTR,#i
00C6 F0                MOVX    @DPTR,A
00C7         ?C0033:
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 14  

00C7 900000      R     MOV     DPTR,#i
00CA E0                MOVX    A,@DPTR
00CB FF                MOV     R7,A
00CC C3                CLR     C
00CD 9403              SUBB    A,#03H
00CF 4003              JC      $ + 5H
00D1 020000      R     LJMP    ?C0034
                                           ; SOURCE LINE # 91
00D4 EF                MOV     A,R7
00D5 04                INC     A
00D6 A3                INC     DPTR
00D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
00D8 C3                CLR     C
00D9 9403              SUBB    A,#03H
00DB 402F              JC      ?C0036
                                           ; SOURCE LINE # 93
00DD E4                CLR     A
00DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 94
00DF 900000      R     MOV     DPTR,#i
00E2 E0                MOVX    A,@DPTR
00E3 2400        R     ADD     A,#LOW TxI2S_Buff_TD
00E5 F582              MOV     DPL,A
00E7 E4                CLR     A
00E8 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
00EA F583              MOV     DPH,A
00EC E0                MOVX    A,@DPTR
00ED FF                MOV     R7,A
00EE 900000      R     MOV     DPTR,#n
00F1 E0                MOVX    A,@DPTR
00F2 2400        R     ADD     A,#LOW TxI2S_Buff_TD
00F4 F582              MOV     DPL,A
00F6 E4                CLR     A
00F7 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
00F9 F583              MOV     DPH,A
00FB E0                MOVX    A,@DPTR
00FC FB                MOV     R3,A
00FD 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
0100 7405              MOV     A,#05H
0102 F0                MOVX    @DPTR,A
0103 7D80              MOV     R5,#080H
0105 7C01              MOV     R4,#01H
0107 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 95
010A 802A              SJMP    ?C0037
010C         ?C0036:
                                           ; SOURCE LINE # 96
010C 900000      R     MOV     DPTR,#i
010F E0                MOVX    A,@DPTR
0110 2400        R     ADD     A,#LOW TxI2S_Buff_TD
0112 F582              MOV     DPL,A
0114 E4                CLR     A
0115 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
0117 F583              MOV     DPH,A
0119 E0                MOVX    A,@DPTR
011A FF                MOV     R7,A
011B 900000      R     MOV     DPTR,#n
011E E0                MOVX    A,@DPTR
011F 2400        R     ADD     A,#LOW TxI2S_Buff_TD
0121 F582              MOV     DPL,A
0123 E4                CLR     A
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 15  

0124 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
0126 F583              MOV     DPH,A
0128 E0                MOVX    A,@DPTR
0129 FB                MOV     R3,A
012A 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
012D 7401              MOV     A,#01H
012F F0                MOVX    @DPTR,A
0130 7D80              MOV     R5,#080H
0132 FC                MOV     R4,A
0133 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 97
0136         ?C0037:
                                           ; SOURCE LINE # 98
0136 900000      R     MOV     DPTR,#i
0139 E0                MOVX    A,@DPTR
013A FB                MOV     R3,A
013B 75F080            MOV     B,#080H
013E 900000      R     MOV     DPTR,#TxI2S
0141 120000      E     LCALL   ?C?OFFXADD
0144 EB                MOV     A,R3
0145 2583              ADD     A,DPH
0147 F583              MOV     DPH,A
0149 FE                MOV     R6,A
014A E582              MOV     A,DPL
014C EE                MOV     A,R6
014D E4                CLR     A
014E AD82              MOV     R5,DPL
0150 AC06              MOV     R4,AR6
0152 C005              PUSH    AR5
0154 7400        R     MOV     A,#LOW TxI2S_Buff_TD
0156 2B                ADD     A,R3
0157 F582              MOV     DPL,A
0159 E4                CLR     A
015A 3400        R     ADDC    A,#HIGH TxI2S_Buff_TD
015C F583              MOV     DPH,A
015E E0                MOVX    A,@DPTR
015F FF                MOV     R7,A
0160 7B01              MOV     R3,#01H
0162 7A00        R     MOV     R2,#HIGH TxI2S_Stage
0164 7900        R     MOV     R1,#LOW TxI2S_Stage
0166 E9                MOV     A,R1
0167 EA                MOV     A,R2
0168 E4                CLR     A
0169 AB01              MOV     R3,AR1
016B D005              POP     AR5
016D 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 99
0170 900000      R     MOV     DPTR,#i
0173 E0                MOVX    A,@DPTR
0174 2400        R     ADD     A,#LOW TxI2S_Zero_TD
0176 F582              MOV     DPL,A
0178 E4                CLR     A
0179 3400        R     ADDC    A,#HIGH TxI2S_Zero_TD
017B F583              MOV     DPH,A
017D E0                MOVX    A,@DPTR
017E FF                MOV     R7,A
017F 900000      R     MOV     DPTR,#n
0182 E0                MOVX    A,@DPTR
0183 2400        R     ADD     A,#LOW TxI2S_Zero_TD
0185 F582              MOV     DPL,A
0187 E4                CLR     A
0188 3400        R     ADDC    A,#HIGH TxI2S_Zero_TD
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 16  

018A F583              MOV     DPH,A
018C E0                MOVX    A,@DPTR
018D FB                MOV     R3,A
018E 900000      E     MOV     DPTR,#?_CyDmaTdSetConfiguration?BYTE+04H
0191 7402              MOV     A,#02H
0193 F0                MOVX    @DPTR,A
0194 7D80              MOV     R5,#080H
0196 7C01              MOV     R4,#01H
0198 120000      E     LCALL   _CyDmaTdSetConfiguration
                                           ; SOURCE LINE # 100
019B 900000      R     MOV     DPTR,#i
019E E0                MOVX    A,@DPTR
019F F9                MOV     R1,A
01A0 75F080            MOV     B,#080H
01A3 900000      R     MOV     DPTR,#TxI2S
01A6 120000      E     LCALL   ?C?OFFXADD
01A9 E9                MOV     A,R1
01AA 2583              ADD     A,DPH
01AC F583              MOV     DPH,A
01AE FE                MOV     R6,A
01AF E582              MOV     A,DPL
01B1 EE                MOV     A,R6
01B2 E4                CLR     A
01B3 AB82              MOV     R3,DPL
01B5 AA06              MOV     R2,AR6
01B7 C002              PUSH    AR2
01B9 C003              PUSH    AR3
01BB 7400        R     MOV     A,#LOW TxI2S_Zero_TD
01BD 29                ADD     A,R1
01BE F582              MOV     DPL,A
01C0 E4                CLR     A
01C1 3400        R     ADDC    A,#HIGH TxI2S_Zero_TD
01C3 F583              MOV     DPH,A
01C5 E0                MOVX    A,@DPTR
01C6 FF                MOV     R7,A
01C7 7B01              MOV     R3,#01H
01C9 7A00        R     MOV     R2,#HIGH TxI2S_Zero
01CB 7900        R     MOV     R1,#LOW TxI2S_Zero
01CD E9                MOV     A,R1
01CE EA                MOV     A,R2
01CF E4                CLR     A
01D0 AD01              MOV     R5,AR1
01D2 AC02              MOV     R4,AR2
01D4 D003              POP     AR3
01D6 D002              POP     AR2
01D8 120000      E     LCALL   _CyDmaTdSetAddress
                                           ; SOURCE LINE # 101
01DB 900000      R     MOV     DPTR,#i
01DE E0                MOVX    A,@DPTR
01DF 04                INC     A
01E0 F0                MOVX    @DPTR,A
01E1 020000      R     LJMP    ?C0033
01E4         ?C0034:
                                           ; SOURCE LINE # 102
01E4 900000      E     MOV     DPTR,#TxI2S_Buff_DmaHandle
01E7 E0                MOVX    A,@DPTR
01E8 FF                MOV     R7,A
01E9 120000      E     LCALL   _CyDmaClearPendingDrq
                                           ; SOURCE LINE # 103
01EC 900000      E     MOV     DPTR,#TxI2S_Buff_DmaHandle
01EF E0                MOVX    A,@DPTR
01F0 FF                MOV     R7,A
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 17  

01F1 900000      R     MOV     DPTR,#TxI2S_Buff_TD
01F4 E0                MOVX    A,@DPTR
01F5 FD                MOV     R5,A
01F6 120000      E     LCALL   _CyDmaChSetInitialTd
                                           ; SOURCE LINE # 104
01F9 900000      E     MOV     DPTR,#TxI2S_Zero_DmaHandle
01FC E0                MOVX    A,@DPTR
01FD FF                MOV     R7,A
01FE 120000      E     LCALL   _CyDmaClearPendingDrq
                                           ; SOURCE LINE # 105
0201 900000      E     MOV     DPTR,#TxI2S_Zero_DmaHandle
0204 E0                MOVX    A,@DPTR
0205 FF                MOV     R7,A
0206 900000      R     MOV     DPTR,#TxI2S_Zero_TD
0209 E0                MOVX    A,@DPTR
020A FD                MOV     R5,A
020B 120000      E     LCALL   _CyDmaChSetInitialTd
                                           ; SOURCE LINE # 107
020E 900000      E     MOV     DPTR,#TxI2S_Zero_DmaHandle
0211 E0                MOVX    A,@DPTR
0212 FF                MOV     R7,A
0213 7D01              MOV     R5,#01H
0215 120000      E     LCALL   _CyDmaChEnable
                                           ; SOURCE LINE # 108
0218 900000      E     MOV     DPTR,#TxI2S_Buff_DmaHandle
021B E0                MOVX    A,@DPTR
021C FF                MOV     R7,A
021D 7D01              MOV     R5,#01H
021F 120000      E     LCALL   _CyDmaChSetRequest
                                           ; SOURCE LINE # 109
0222 900000      E     MOV     DPTR,#TxI2S_Buff_DmaHandle
0225 E0                MOVX    A,@DPTR
0226 FF                MOV     R7,A
0227 7D01              MOV     R5,#01H
0229 120000      E     LCALL   _CyDmaChEnable
                                           ; SOURCE LINE # 110
022C 900000      E     MOV     DPTR,#TxI2S_Stage_DmaHandle
022F E0                MOVX    A,@DPTR
0230 FF                MOV     R7,A
0231 7D01              MOV     R5,#01H
0233 120000      E     LCALL   _CyDmaChEnable
                                           ; SOURCE LINE # 111
0236 22                RET     
             ; FUNCTION DmaTxStart (END)

             ; FUNCTION PCM3060_TxBuf (BEGIN)
                                           ; SOURCE LINE # 113
                                           ; SOURCE LINE # 114
0000 120000      E     LCALL   SyncSOF_USB_Buffer
0003 7E00              MOV     R6,#00H
0005 7C01              MOV     R4,#01H
0007 7D80              MOV     R5,#080H
0009 120000      E     LCALL   ?C?IMUL
000C 7400        R     MOV     A,#LOW TxI2S
000E 2F                ADD     A,R7
000F F9                MOV     R1,A
0010 7400        R     MOV     A,#HIGH TxI2S
0012 3E                ADDC    A,R6
0013 FA                MOV     R2,A
0014 7B01              MOV     R3,#01H
                                           ; SOURCE LINE # 115
0016         ?C0039:
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 18  

0016 22                RET     
             ; FUNCTION PCM3060_TxBuf (END)

             ; FUNCTION PCM3060_RxBuf (BEGIN)
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 118
0000 120000      E     LCALL   SyncSOF_USB_Buffer
0003 7E00              MOV     R6,#00H
0005 7C01              MOV     R4,#01H
0007 7D80              MOV     R5,#080H
0009 120000      E     LCALL   ?C?IMUL
000C 7400        R     MOV     A,#LOW RxI2S
000E 2F                ADD     A,R7
000F F9                MOV     R1,A
0010 7400        R     MOV     A,#HIGH RxI2S
0012 3E                ADDC    A,R6
0013 FA                MOV     R2,A
0014 7B01              MOV     R3,#01H
                                           ; SOURCE LINE # 119
0016         ?C0040:
0016 22                RET     
             ; FUNCTION PCM3060_RxBuf (END)

             ; FUNCTION _PCM3060_SetRegister (BEGIN)
                                           ; SOURCE LINE # 121
0000 900000      R     MOV     DPTR,#reg
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 ED                MOV     A,R5
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 122
0008 E4                CLR     A
0009 900000      R     MOV     DPTR,#state
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 123
000D A3                INC     DPTR
000E F0                MOVX    @DPTR,A
000F A3                INC     DPTR
0010 F0                MOVX    @DPTR,A
0011         ?C0041:
                                           ; SOURCE LINE # 125
0011 900000      R     MOV     DPTR,#state
0014 E0                MOVX    A,@DPTR
0015 FF                MOV     R7,A
0016 C3                CLR     C
0017 9402              SUBB    A,#02H
0019 505F              JNC     ?C0042
                                           ; SOURCE LINE # 126
001B EF                MOV     A,R7
001C 14                DEC     A
001D 602F              JZ      ?C0045
001F 04                INC     A
0020 70EF              JNZ     ?C0041
                                           ; SOURCE LINE # 127
0022         ?C0044:
                                           ; SOURCE LINE # 128
0022 900000      R     MOV     DPTR,#reg
0025 E0                MOVX    A,@DPTR
0026 900000      R     MOV     DPTR,#pcm3060_cmd
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 129
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 19  

002A 900000      R     MOV     DPTR,#val
002D E0                MOVX    A,@DPTR
002E 900000      R     MOV     DPTR,#pcm3060_cmd+01H
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 130
0032 7B01              MOV     R3,#01H
0034 7A00        R     MOV     R2,#HIGH pcm3060_cmd
0036 7900        R     MOV     R1,#LOW pcm3060_cmd
0038 900000      E     MOV     DPTR,#?_I2C_MasterWriteBuf?BYTE+04H
003B 7402              MOV     A,#02H
003D F0                MOVX    @DPTR,A
003E E4                CLR     A
003F A3                INC     DPTR
0040 F0                MOVX    @DPTR,A
0041 7F46              MOV     R7,#046H
0043 120000      E     LCALL   _I2C_MasterWriteBuf
                                           ; SOURCE LINE # 131
0046 900000      R     MOV     DPTR,#state
0049 E0                MOVX    A,@DPTR
004A 04                INC     A
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 132
004C 80C3              SJMP    ?C0041
                                           ; SOURCE LINE # 133
004E         ?C0045:
                                           ; SOURCE LINE # 134
004E 120000      E     LCALL   I2C_MasterStatus
;---- Variable 'i' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 135
0051 EF                MOV     A,R7
0052 30E708            JNB     ACC.7,?C0046
                                           ; SOURCE LINE # 136
0055 900000      R     MOV     DPTR,#state
0058 E0                MOVX    A,@DPTR
0059 14                DEC     A
005A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 137
005B 800A              SJMP    ?C0047
005D         ?C0046:
005D EF                MOV     A,R7
005E 30E106            JNB     ACC.1,?C0047
                                           ; SOURCE LINE # 138
0061 900000      R     MOV     DPTR,#state
0064 E0                MOVX    A,@DPTR
0065 04                INC     A
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 139
0067         ?C0047:
                                           ; SOURCE LINE # 140
0067 900000      R     MOV     DPTR,#err
006A 74FF              MOV     A,#0FFH
006C F5F0              MOV     B,A
006E 120000      E     LCALL   ?C?IILDX
0071 45F0              ORL     A,B
0073 709C              JNZ     ?C0041
0075 7F01              MOV     R7,#01H
0077 22                RET     
                                           ; SOURCE LINE # 141
                                           ; SOURCE LINE # 142
                                           ; SOURCE LINE # 143
0078 8097              SJMP    ?C0041
007A         ?C0042:
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 20  

                                           ; SOURCE LINE # 144
007A 7F00              MOV     R7,#00H
                                           ; SOURCE LINE # 145
007C         ?C0050:
007C 22                RET     
             ; FUNCTION _PCM3060_SetRegister (END)

             ; FUNCTION PCM3060_Init (BEGIN)
                                           ; SOURCE LINE # 147
                                           ; SOURCE LINE # 148
0000 120000      E     LCALL   I2S_Start
                                           ; SOURCE LINE # 149
0003 120000      R     LCALL   DmaRxInit
                                           ; SOURCE LINE # 150
0006 120000      R     LCALL   DmaTxInit
                                           ; SOURCE LINE # 151
0009 120000      R     LCALL   PCM3060_Stop
                                           ; SOURCE LINE # 152
000C         ?C0051:
000C 22                RET     
             ; FUNCTION PCM3060_Init (END)

             ; FUNCTION PCM3060_Start (BEGIN)
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 155
0000 7DC0              MOV     R5,#0C0H
0002 7F40              MOV     R7,#040H
0004 120000      R     LCALL   _PCM3060_SetRegister
                                           ; SOURCE LINE # 156
0007 7D80              MOV     R5,#080H
0009 7F45              MOV     R7,#045H
000B 120000      R     LCALL   _PCM3060_SetRegister
                                           ; SOURCE LINE # 157
000E 120000      R     LCALL   DmaRxStart
                                           ; SOURCE LINE # 158
0011 120000      R     LCALL   DmaTxStart
                                           ; SOURCE LINE # 159
0014 120000      E     LCALL   I2S_EnableRx
                                           ; SOURCE LINE # 160
0017 120000      E     LCALL   I2S_EnableTx
                                           ; SOURCE LINE # 161
001A 22                RET     
             ; FUNCTION PCM3060_Start (END)

             ; FUNCTION PCM3060_Stop (BEGIN)
                                           ; SOURCE LINE # 164
                                           ; SOURCE LINE # 166
0000 7DF0              MOV     R5,#0F0H
0002 7F40              MOV     R7,#040H
0004 120000      R     LCALL   _PCM3060_SetRegister
0007 900000      R     MOV     DPTR,#ret
000A EF                MOV     A,R7
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 167
000C 120000      E     LCALL   I2S_DisableRx
                                           ; SOURCE LINE # 168
000F 120000      E     LCALL   I2S_DisableTx
                                           ; SOURCE LINE # 169
0012 900000      E     MOV     DPTR,#RxI2S_Stage_DmaHandle
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
0017 120000      E     LCALL   _CyDmaChDisable
C51 COMPILER V9.51   PCM3060                                                               10/24/2015 08:30:42 PAGE 21  

                                           ; SOURCE LINE # 170
001A 900000      E     MOV     DPTR,#RxI2S_Buff_DmaHandle
001D E0                MOVX    A,@DPTR
001E FF                MOV     R7,A
001F 120000      E     LCALL   _CyDmaChDisable
                                           ; SOURCE LINE # 171
0022 900000      E     MOV     DPTR,#TxI2S_Stage_DmaHandle
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 120000      E     LCALL   _CyDmaChDisable
                                           ; SOURCE LINE # 172
002A 900000      E     MOV     DPTR,#TxI2S_Buff_DmaHandle
002D E0                MOVX    A,@DPTR
002E FF                MOV     R7,A
002F 120000      E     LCALL   _CyDmaChDisable
                                           ; SOURCE LINE # 173
0032 900000      E     MOV     DPTR,#TxI2S_Zero_DmaHandle
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 120000      E     LCALL   _CyDmaChDisable
                                           ; SOURCE LINE # 174
003A 120000      E     LCALL   I2S_ClearRxFIFO
                                           ; SOURCE LINE # 175
003D 120000      E     LCALL   I2S_ClearTxFIFO
                                           ; SOURCE LINE # 176
0040 900000      R     MOV     DPTR,#ret
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
                                           ; SOURCE LINE # 177
0045         ?C0053:
0045 22                RET     
             ; FUNCTION PCM3060_Stop (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1468    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   2322      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
